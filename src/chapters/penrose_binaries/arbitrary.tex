In the previous sections, all of our considerations depended upon the existence of a conserved negative and ``global'' (as seen by a static observer at infinity) energy. This is only possible if the spacetime under consideration is stationary. In this section we will demonstrate how one can still observe the Penrose Process even in cases where this assumption is relaxed and there is no global and conserved energy available to be explored, thus, looking only at locally defined quantities. This technique allows one to study the Penrose mechanism even when the spacetime metric is defined numerically, such as is the case in numerical simulations of binary black hole collisions.

\subsection{3+1 split of the geodesic equation}

To understand our proposed technique, it is first fundamental to understand how General Relativity can be reformulated by explicitly separating its spatial and temporal components. This decomposition know as a ``3+1 split'' is very commonly used in Numerical Relativity and was motivated by the first attempts of posing GR as a Cauchy problem. Numerical Relativity codes very often provide ways to access the spacetime metrics being evolved in terms of it's 3+1 components. In this section, we will assume familiarity of the reader with this concept which can be readily reviewed in Refs.~\cite{Alcubierre2012-xp, 9780521514071, 9781108928250}. Given that the Penrose process requires us to investigate the trajectories of particles in a background spacetime, we must now solve the geodesic equation taking into account that the spacetime metric (and it's derivatives) will be provided via 3+1 split components. The need to solve the geodesic equation in this context overlaps with works that are interested in simulating an image of a black hole, that is, determining what a camera would capture if it was pointed towards one. In this type of simulation a technique called \emph{backwards ray tracing} is employed, which consists in choosing a position and orientation of a model camera and integrating the trajectory of the photons that hit the camera's ``film'' backwards in time. The color of each pixel in the resulting image is then computed by analyzing whether the particle was swollen or the color of the ``obstacle'' that it hit.

Although our purposes differ, the mathematical tools used in backwards ray tracing are fundamental in the technique we will soon develop. The complete and detailed derivation of the 3+1 split of the geodesic equation used in this section can be found in Ref.~\cite{Vincent_2012}. We shall recover from this reference only the nomenclatures and concepts necessary for the further development of our proposal. To begin with, we consider a globally hyperbolic background spacetime described by a metric tensor $\mtrtens{\mu}{\nu}$. Being globally hyperbolic, it admits a one parameter space-like foliation of constant coordinate time $t$ hypersurfaces that we shall denote by $\Sigma_t$. We will also assume that the space-time has coordinates\footnote{We use the convention that Greek indices run over all 4 coordinates while Latin indices run over only spatial coordinates.} that are compatible with the foliation, that is, $x^0=t$ and $x^i$ span $\Sigma_t$. Let us denote the unit time-like (future directed) normal vector of $\Sigma_t$ by $n^\mu$. This vector coincides with the 4-velocity of an observer whose worldlines are orthogonal to $\Sigma_t$, which we call the \emph{Eulerian Observer}, or $\mathcal{O}_E$. We denote by $\gamma_{\mu\nu}$ the spatial metric induced in $\Sigma_t$, $D_i$ its associated covariant derivative, $K_{ij}$ its extrinsic curvature tensor, $N$ the lapse function and $\beta^\mu$ the shift vector. The 3+1 split metric then becomes
%
\begin{equation}
  \ud s^2 = -N^2 \ud t^2 + \gamma_{ij}(\ud x^i + \beta^i \ud t)(\ud x^j + \beta^j \ud t).
  \label{eq:arbitrary_penrose_decomposed_metric}
\end{equation}

Let us now consider a particle $\mathcal{P}$ of 4-momentum $p^\mu$. Let us assume that the particle moves in either a time-like or null geodesic (and thus without the influence of any force but gravity), which implies that
%
\begin{equation}
  p_\mu p^\mu = m^2\delta,
  \label{eq:arbitrary_penrose_p_norm}
\end{equation}
% 
where $\delta = -1$ for massive particles (and in this case $m$ represents the particle's mass) or $\delta=0$ for photons. The 4-momentum can be decomposed as
%
\begin{equation}
  p^\mu = E(n^\mu + V^\mu)
  \label{eq:arbitrary_penrose_p_decomp}
\end{equation}
%
where $E$ represents the particle's energy as measured by $\mathcal{O}_E$ (by definition,  $E = - n_\mu p^\mu$) and $V^\mu$ represents the 3-velocity of the particle, also as measured by $\mathcal{O}_E$. The 3-momentum $P^\mu$ of $\mathcal{P}$ as observed by $\mathcal{O}_E$ is thus
%
\begin{equation}
  P^\mu \equiv \tens{\gamma}{\mu}{\nu} p^\nu = E V^\mu.
  \label{eq:arbitrary_penrose_3_momentum}
\end{equation}
%
The normalization of $p^\mu$ and $n_\mu$, together with the orthogonality relation $n_\mu V^\mu = 0$ and Eq.~\eqref{eq:arbitrary_penrose_p_decomp} imposes
%
\begin{equation}
  V_\mu V^\mu = V_i V^i  = 1 + \delta\left(\frac{m}{E}\right)^2.
  \label{eq:arbitrary_penrose_V_norm}
\end{equation}
%
Finally, parametrizing the particle's position vector $X^i$ by the coordinate time (that is $x^i = X^i(t)$) the geodesic equation of $\mathcal{P}$ is decomposed in a set of 7 equations, namely
%
\begin{align}
  \der{X^i}{t} & = N V^i - \beta^i \label{eq:arbitrary_penrose_geodesic_eq_X}                                                                                                                                                  \\
  \der{V^i}{t} & = N V^j\left[ V^i \left( \partial_j \ln N - K_{jk} V^k \right) + 2 \tens{K}{i}{j} - {}^3\Gamma^{i}_{jk}V^k\right] - \gamma^{ij}\partial_j N - V^j\partial_j\beta^i \label{eq:arbitrary_penrose_geodesic_eq_V} \\
  \der{E}{t}   & = E (N K_{jk} V^j V^k - V^j \partial_j N) \label{eq:arbitrary_penrose_geodesic_eq_E}
\end{align}
%
where ${}^3\Gamma^{i}_{jk}$ are the Christoffel symbols associated with $\gamma_{ij}$.

\subsection{Penrose process}

Eq.~\eqref{eq:arbitrary_penrose_geodesic_eq_E} gives us the time evolution of the energy as measured by the Eulerian Observer when the particle travels along its path. From here on, we will refer to this quantity as the \emph{local energy}, since it is measured locally by the observer that is orthogonal to the foliation and denote it by $E$. Up until now, we've been dealing with what we shall now call the \emph{global energy}, that is, the energy as measured by a static observer at infinity, that we will now denote by $\varepsilon$. Our study will require, further on, that we find a relation between these two quantities, so we shall do so now. The global energy, $\varepsilon$, is given when the spacetime under consideration possesses a global time-like Killing vector field $\xi^\mu = (\partial_t)^\mu$ and is defined as
%
\begin{equation}
  \varepsilon =p_\mu \xi^\mu.
  \label{eq:arbitrary_penrose_global_energy_def}
\end{equation}
%
Expanding the contraction in Eq.~\eqref{eq:arbitrary_penrose_global_energy_def} with the general metric given in Eq.~\eqref{eq:arbitrary_penrose_decomposed_metric} and with the 4-momentum given in Eq.~\eqref{eq:arbitrary_penrose_p_decomp}, we get
%
\begin{equation}
  \varepsilon = \left( N - \gamma_{ij} \beta^i V^j \right) E.
  \label{eq:arbitrary_penrose_local_global_energy_relation}
\end{equation}

Previously, we were able to determine if energy was extracted as a result of a particle split-up process by comparing the global energies of the particles involved, one of which must have had a negative energy value. Since global energy was conserved along the particle's trajectories, it did not matter where and when this comparison took place. If we, however, relax the assumption that the spacetime under analysis possesses a global time-like killing vector field, the quantity given by Eq.~\eqref{eq:arbitrary_penrose_global_energy_def} is no longer physically meaningful as an energy measure, thus restricting all physical arguments to be made in terms of local energy measurements. Furthermore, local energy, as can be explicitly seen in Eq.~\eqref{eq:arbitrary_penrose_geodesic_eq_E}, is not in general conserved along the particle's trajectory and must always be positive in order to be physically meaningful. Given these restrictions, how can one compare the local energies of the particles involved in a breakup (or collisional) process in a physically meaningful way in order to determine if energy was extracted from the system or not? To answer this question, one must note that there is an important consequence of Eq.~\eqref{eq:arbitrary_penrose_local_global_energy_relation} to be observed if the spacetime metric is asymptotically flat, that is, if infinitely far away from the black hole (or holes) the spacetime becomes the Minkowski solution. In this case, when spatial coordinates tend to infinity, $\gamma_{ij} \rightarrow \eta_{ij}$, $\beta^i \rightarrow 0$ and $N \rightarrow 1$ which implies, via Eq.~\eqref{eq:arbitrary_penrose_local_global_energy_relation}, that $\varepsilon = E$. In other words, if the spacetime under consideration is asymptotically flat, global and local energy coincide at infinity, thus implying that the global energy is still physically meaningful infinitely far away from the gravitational center. Not only that, Eq.~\eqref{eq:arbitrary_penrose_geodesic_eq_E} tells us that local and global energies are conserved at infinity, since $K_{ij} \rightarrow 0$ and $N$ becomes constant as we approach the Minkowski solution.

In practical terms (and especially when analyzing spacetime metrics obtained from numerical simulation codes) it's not possible to integrate a trajectory to spatial infinity since the coordinates commonly employed are not compactifyied and such compactification is often difficult or impossible to perform in practice. Instead of attempting to do so, our technique follows again a practice common in backward ray tracing works, more specifically, we follow the prescription given by Ref.~\cite{Bohn:2014xxa}. Given a set of initial conditions $X^i(0), V^i(0), E(0)$, we evolve the system formed by Eqs.~\eqref{eq:arbitrary_penrose_geodesic_eq_X}-\eqref{eq:arbitrary_penrose_geodesic_eq_E} numerically until the particle reaches a sphere of predetermined radius that we denominate the \emph{background sphere}. The radius of this sphere is chosen so that the difference between global and local energy becomes smaller than a certain threshold $\delta_E$, that is, 
%
\begin{equation}
  |E(t_f)- \varepsilon(t_f)| < \delta_E,
  \label{eq:arbitrary_penrose_background_sphere_cplision_condition}
\end{equation}
%
where $t_f$ represents the final integration coordinate time. Additionally, we also stop integrating if the particle is absorbed by the system at a given time of ``swallowing'' $t_S$. A particle is considered absorbed if the difference of its local energy at $t_S$ and at $t=0$ gets larger than a certain swallowing threshold $\delta_S$, that is, 
%
\begin{equation}
  |E(t_S) - E(0)|/E(0) = \delta_S.
  \label{eq:arbitrary_penrose_swallowing_condition}
\end{equation}

The scheme described above was implemented in a public \texttt{C++} code available in Ref.~\cite{GRLensingRepo}. Compilation and usage instructions are provided within the repository. The code was originally created with the intent of producing Gravitational Lensing images (hence the name) but was later adapted to investigate the Penrose process. The code consists of a \emph{kernel} using the ARKODE~\cite{ARKODE} infrastructure for integrating the geodesic equation and verifying the stopping criteria of Eqs.~\eqref{eq:arbitrary_penrose_background_sphere_cplision_condition} and \eqref{eq:arbitrary_penrose_swallowing_condition} for an arbitrary spacetime metric. The kernel expects only to receive a set of functions that compute the ADM quantities of the spacetime metric (lapse, shift, extrinsic curvature and a few derivatives of these objects). Each spacetime metric is then a \emph{plugin} (a dynamically loaded library) that provides such functions at runtime. This allows the integration problem be separated of the problem of determining the ADM quantities of a given spacetime metric. Users can focus on the latter, since the kernel solves the former for an arbitrary input metric. In addition to spacetime metrics being plugins, file readers and writers are also plugins in the same way. This allows the user to implement different input/output data formats for the trajectories according to their needs. Currently, only a simple \texttt{ASCII} file writer is available, but that is enough for our current purposes. The behavior of the program is driven at runtime by a command line interface, \texttt{YAML} configuration files and the available dynamic libraries implementing spacetime metrics and writers. A basic configuration file named \texttt{grlensing\_config.yaml} is expected to be present, detailing various ARKODE internal settings, such as error tolerances, max. number of iterations, etc. It also details the metric and file writer plugins to be loaded and made available at runtime as well as settings of the \texttt{dump-metric} command. Additional configuration files are required in certain modes (for instance, describing a certain spacetime parameters and initial conditions of a particle). Through the command line, the user selects the operation mode of the code. At the time of writing, the available modes of operation are (these can be viewed by invoking the program with \texttt{--help})
%
\begin{itemize}
  \item \texttt{list-plugins}: Lists all the plugins that are set to be loaded (and were found)
  \item \texttt{dump-metric}: Writes a spacetime metric in a cube of arbitrary size and arbitrary number of internal points. This option is used mostly for debugging the implementation of a spacetime metric plugin.
  \item \texttt{integrate-trajectory}: Integrates a single particle trajectory with the specified configurations.
  \item \texttt{penrose-breakup}: Integrates a particle breakup process by using two particle configurations and obtaining a third from conservation of 4-momentum.
\end{itemize}
%
The general workflow for finding explicit examples of the Penrose process is as follows:
%
\begin{enumerate}
  \item Chose a break-up point. This will be the initial position of all three particle participating in the process. We know that in order to extract energy this break-up must occur inside the ergosphere. In general, when the spacetime under study does not possess a global time-like killing vector field, we consider the ergosphere to be the now observer dependent region where the metric component $\mtrtens{t}{t}$ changes sign.
  \item Chose initial velocities and energy for the ingoing particle in such a way that it is an escaping orbit when integrated forward and backward in time. Requiring that the orbit is escaping in both ``temporal directions'' makes it more likely that one of the particles produced after the break-up will escape to infinity.
  \item Choose initial velocities and energy for the particle that is absorbed by the black whole and will be the equivalent of the negative energy orbit. These parameters are chosen so that the particle is counter-rotating with the black whole that will absorb it, so that its angular momentum can actually be decreased upon absorption.
  \item The escape orbit parameters are computed automatically by the code via 4-momentum conservation at the break-up point.
\end{enumerate}
%
Several utility scripts are also provided in the program repository under the \texttt{resources} folder. These scripts serve multiple purposes, from plotting trajectories, energies, the ADM quantities of dumped spacetime metrics or even generating a skeleton of a metric plugin that can be filled by users. It also includes an assortment of papers and notes required in the development of the code.

\subsection{Parametrizing initial velocities}

As was previously mentioned, we must choose 7 parameters in order to solve the 3+1 split geodesic equation. Once initial positions $X^i(0)$ and local energy $E(0)$ values are chosen one is still free to choose 3 initial velocity $V^i(0)$ values. We have chosen to consider only orbits in the $z=0$ plane, which implies $V^3(0)=0$. We do not believe that this choice represents a loss of generality since it is valid for all cases of interest, including astrophysical black hole binaries. By comparing Eq.~\eqref{eq:arbitrary_penrose_V_norm} to a general bi-variate quadratic form
%
\begin{equation}
  A X^2 + 2 B X Y + C Y^2 + 2 D X + 2 F Y + G = 0,
  \label{eq:arbitrary_penrose_general_quadratic_form}
\end{equation}
%
it is possible to identify
%
\begin{equation}
  A = \gamma_{22},\, B = \gamma_{23},\, C = \gamma_{33},\, G = -\left[ 1 - \left( \frac{m}{E} \right)^2 \right],\, D = F = 0,
\end{equation}
%
and the variables $X$ and $Y$ with $V^1$ and $V^2$, respectively. This quadratic describes a non-degenerate real ellipse in the $V^1$-$V^2$ plane centered around $V^1_\circ$ and $V^2_\circ$ with semi-axis lengths $\alpha_\pm$ and counterclockwise angle $\phi$ of rotation from the $V^1$ axis to it's semi-major axis if after defining~\cite{Hart2002}
%
\begin{equation}
  \Delta = 
  \begin{vmatrix}
    A & B & D  \\
    B & C & F  \\
    D & F & G
  \end{vmatrix}
  = \left( 1 - \left( \frac{m}{E} \right)^2 \right) \left(\gamma_{23}^2-\gamma_{22} \gamma_{33}\right)
  \label{eq:arbitrary_penrose_quadratic_determinant}
  ,
\end{equation}
%
\begin{equation}
  J = 
  \begin{vmatrix}
    A & B \\
    B & C \\
  \end{vmatrix}
  = \gamma_{22} + \gamma_{33} - \gamma_{23}^2
  \label{eq:arbitrary_penrose_quadratic_J}
\end{equation}
%
and
%
\begin{equation}
  I = A + C = \gamma_{22} + \gamma_{33},
  \label{eq:arbitrary_penrose_quadratic_I}
\end{equation}
%
one has $\Delta \neq 0$, $J > 0$, $\Delta/I < 0$ and $\gamma_{22} \neq \gamma_{33}$. Explicitly, we have~\cite{Larson2006, Young2010, Lawrence2014}
%
\begin{equation}
  V^1_\circ = V^2_\circ = 0,
  \label{eq:arbitrary_penrose_ellipse_centers}
\end{equation}
%
\begin{equation}
  \alpha_\pm = \sqrt{ \frac{2 \left( 1 - \left(m/E\right)^2 \right)}{\gamma_{22} \mp \sqrt{4 \gamma_{23}^2 + \left( \gamma_{22} - \gamma_{33} \right)^2} +\gamma_{33}} }
  \label{eq:arbitrary_penrose_ellipse_axis}
\end{equation}
%
and
\begin{equation}
  \phi =
  \begin{cases}
    0                                                                                                 & \text{if } \gamma_{23} = 0 \text{ and } \gamma_{22} < \gamma_{33}    \\
    \frac{\pi}{2}                                                                                     & \text{if } \gamma_{23} = 0 \text{ and } \gamma_{22} > \gamma_{33}    \\
    \frac{1}{2} \cot^{-1} \left( \frac{\gamma_{22}-\gamma_{33}}{2\gamma_{23}} \right)                 & \text{if } \gamma_{23} \neq 0 \text{ and } \gamma_{22} < \gamma_{33} \\
    \frac{\pi}{2} + \frac{1}{2} \cot^{-1} \left( \frac{\gamma_{22}-\gamma_{33}}{2\gamma_{23}} \right) & \text{if } \gamma_{23} \neq 0 \text{ and } \gamma_{22} > \gamma_{33}
  \end{cases}
  .
  \label{eq:arbitrary_penrose_ellipse_angle}
\end{equation}
%
With these quantities, it is possible to describe the ellipse in terms of an arbitrary parameter $\Theta \in \left[0,2\pi\right]$, that is,
%
\begin{align}
  V^{1}\left(\Theta\right) & =  V^{1}_\circ + \alpha_{+} \cos\Theta\cos\phi - \alpha_{-}\sin\Theta\sin\phi                                                  \label{eq:arbitrary_penrose_ellipse_parametric_1} \\
  V^{2}\left(\Theta\right) & = V^{2}_\circ + \alpha_{-} \sin\Theta\cos\phi + \alpha_{+}\cos\Theta\sin\phi, \label{eq:arbitrary_penrose_ellipse_parametric_2}
\end{align}
%
and thus the problem of finding initial velocities that satisfy Eq.~\eqref{eq:arbitrary_penrose_V_norm} is reduced to that of evaluating the right-hand side of Eqs.~\eqref{eq:arbitrary_penrose_ellipse_parametric_1} - \eqref{eq:arbitrary_penrose_ellipse_parametric_2} for some value of $\Theta$, effectively reducing the ``degrees of freedom'' of the problem.

\subsection{Example: Kerr Metric}
\input{src/chapters/penrose_binaries/arbitrary_kerr_example.tex}

\subsection{Example: SKS Metric}
\input{src/chapters/penrose_binaries/arbitrary_SKS_example.tex}